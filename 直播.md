# 基本流程

推流端：采集、前处理、编码、推流

服务端：转码、录制、截图、鉴黄

播放端：拉流、解码、渲染 

互动系统 ：聊天、礼物、点赞

# 采集

## 音频采集

模拟信号-》PCM编码的原始数据-〉aac等压缩格式

关键参数：

>  采样率：模拟信号转换成数字信号， 模拟信号是连续的线，在线上取多少个点即				采样率。kHz 赫兹
>
> 位宽:记录没个点数据的位数16bit
>
> 声道数：声音源的数量 、播放时扬声器的数量
>
> 音频帧：2.5ms～60ms为一帧，根据编码器或具体应用决定，音频是流式的，人造概念

一帧大小计算：

> 采样率X位宽X声道数X音频帧市场

##图像采集

视频与帧动画原理一样



技术参数：

> 分辨率：720X1080
>
> 采样频率：采集图片的速度
>
> 采样格式：摄像头YUV格式 Y灰度值U色彩V饱和度
>
> 传输通道：几个摄像头一块采集，360拍摄6个摄像头拍摄，然后合成

## 采集源

摄像头

屏幕录制 ：游戏

文件推流 ： 春晚出问题替换

# 前处理

##视频

美颜：

> 美白:识别皮肤，调整色值
>
> 磨皮：模糊处理-均值模糊、高斯模糊、中值滤波

滤镜：GPUImage

水印：图像与水印图片的合并



##音频

混音--音频信号的叠加，采样值溢出处理 

降噪--傅立叶变换

变声--音色、音调。SoundTouch三方

# 编码

编码的必要性

> 压缩数据存储空间，减少传输时间

编码原理

> 空间冗余：相邻像素之间的相关性
>
> 时间冗余：相邻图像之间内容相似
>
> 编码冗余：像素值出现的概率不同
>
> 视觉冗余：视觉对细节的不明感性

常见图像编码器

>  H264 h265、vp8、vp9 

H264编码知识

> NALU:网络提取层单元
>
> SPS：包括了一个图像序列的所有信息
>
> PPS：包括了一个图片所有片的信息
>
> I帧：帧内编码帧 （单张图片）
>
> P帧： 前向预测编码帧
>
> B帧：双向预测编码帧
>
> GOP：两个I帧之间的图像组

常见的音频编码器

> AAC
>
> PCM:麦克风采集的原始数据
>
> WAV：PCM前面加个头
>
> OGG ：

流媒体封装格式

>FLV
>
>TS：数字电视rtmp hlv
>
>AVI
>
>等

# 推流&优化

## rtmp

实时消息传输协议

> CDN支持良好
>
> 协议简单易实现--h264 AAC加协议头 

> 基于TCP Adobe私有 不支持浏览器



##WebRTC

> W3C标准 基于UDP

> CDN支持较差

##udp自定义

# 优化思路

保证音频优先传输

调整码率、fps、分辨率

减少传输数据

# 辅助工具

https://www.imooc.com/video/16208

推流--OBS Studio

播放--cutv测试工具

分析h264视频格式--H264BSAnalyzer

分析FLV文件---FLV Parse

播放YUV文件---yuvplayer 